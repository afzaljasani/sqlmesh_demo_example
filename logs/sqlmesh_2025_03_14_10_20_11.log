2025-03-14 10:20:11,539 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for data files: {'db.db'} (connection.py:316)
2025-03-14 10:20:11,907 - MainThread - sqlmesh.core.config.connection - INFO - Using existing DuckDB adapter due to overlapping data file: db.db (connection.py:306)
2025-03-14 10:20:21,940 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Listing data objects in schema db.sqlmesh__sqlmesh_example (evaluator.py:322)
2025-03-14 10:20:21,940 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT CURRENT_CATALOG() (base.py:2113)
2025-03-14 10:20:21,941 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT CURRENT_CATALOG() (base.py:2113)
2025-03-14 10:20:21,942 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'db' AND table_schema = 'sqlmesh__sqlmesh_example') AND table_name IN ('sqlmesh_example__full_model__1100116909', 'sqlmesh_example__seed_model__1248844913', 'sqlmesh_example__sfdc_opp_model__1106821760', 'sqlmesh_example__sfdc_opp_history__796608424__temp', 'sqlmesh_example__sfdc_pipeline__939658849', 'sqlmesh_example__incremental_model__3165396090', 'sqlmesh_example__incremental_test__821161111', 'sqlmesh_example__new_full_model__3421731154', 'sqlmesh_example__sfdc_opp_history__796608424') (base.py:2113)
2025-03-14 10:20:21,973 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'db.sqlmesh__sqlmesh_example' (evaluator.py:1060)
2025-03-14 10:20:21,973 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE SCHEMA IF NOT EXISTS "db"."sqlmesh__sqlmesh_example" (base.py:2113)
2025-03-14 10:20:21,974 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: DESCRIBE "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_pipeline__939658849" (base.py:2113)
2025-03-14 10:20:21,977 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating view 'db.sqlmesh__sqlmesh_example.sqlmesh_example__sfdc_pipeline__939658849' (evaluator.py:1841)
2025-03-14 10:20:21,983 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE VIEW "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_pipeline__939658849" AS SELECT "sfdc_opp_model"."opportunity_id" AS "id", "sfdc_opp_model"."opportunity_name" AS "opportunity_name", "sfdc_opp_model"."opportunity_stage" AS "opportunity_stage", "sfdc_opp_model"."close_date" AS "close_date", ROUND("sfdc_opp_model"."opportunity_probability" * "sfdc_opp_model"."opportunity_amount", 2) AS "expected_amount", CASE WHEN "sfdc_opp_model"."opportunity_stage" = 'demo' THEN 3.99 * "sfdc_opp_model"."opportunity_probability" ELSE NULL END AS "opportunity_probability_new" FROM "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_opp_model__1106821760" AS "sfdc_opp_model" (base.py:2113)
2025-03-14 10:20:21,984 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: COMMENT ON COLUMN "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_pipeline__939658849"."id" IS 'primary key of opportunity table' (base.py:2113)
2025-03-14 10:20:21,984 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: COMMENT ON COLUMN "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_pipeline__939658849"."opportunity_name" IS 'name of the opportunity' (base.py:2113)
2025-03-14 10:20:21,984 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: COMMENT ON COLUMN "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_pipeline__939658849"."opportunity_stage" IS 'stage name from salesforce' (base.py:2113)
2025-03-14 10:20:21,984 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: COMMENT ON COLUMN "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_pipeline__939658849"."close_date" IS 'this is the projected closed date' (base.py:2113)
2025-03-14 10:20:21,985 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: COMMENT ON COLUMN "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_pipeline__939658849"."opportunity_probability_new" IS 'custom probability forecasting' (base.py:2113)
2025-03-14 10:20:22,003 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"db"."sqlmesh_example"."sfdc_pipeline": 1042212341> (evaluator.py:594)
2025-03-14 10:20:22,007 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-13 00:00:00, 2025-03-14 00:00:00) into db.sqlmesh__sqlmesh_example.sqlmesh_example__sfdc_pipeline__939658849' (evaluator.py:648)
2025-03-14 10:20:22,007 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Replacing view 'db.sqlmesh__sqlmesh_example.sqlmesh_example__sfdc_pipeline__939658849' (evaluator.py:1795)
2025-03-14 10:20:22,007 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE OR REPLACE VIEW "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_pipeline__939658849" ("id", "opportunity_name", "opportunity_stage", "close_date", "expected_amount", "opportunity_probability_new") AS SELECT "sfdc_opp_model"."opportunity_id" AS "id", "sfdc_opp_model"."opportunity_name" AS "opportunity_name", "sfdc_opp_model"."opportunity_stage" AS "opportunity_stage", "sfdc_opp_model"."close_date" AS "close_date", ROUND("sfdc_opp_model"."opportunity_probability" * "sfdc_opp_model"."opportunity_amount", 2) AS "expected_amount", CASE WHEN "sfdc_opp_model"."opportunity_stage" = 'demo' THEN 3.99 * "sfdc_opp_model"."opportunity_probability" ELSE NULL END AS "opportunity_probability_new" FROM "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_opp_model__1106821760" AS "sfdc_opp_model" (base.py:2113)
2025-03-14 10:20:22,008 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: COMMENT ON COLUMN "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_pipeline__939658849"."id" IS 'primary key of opportunity table' (base.py:2113)
2025-03-14 10:20:22,008 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: COMMENT ON COLUMN "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_pipeline__939658849"."opportunity_name" IS 'name of the opportunity' (base.py:2113)
2025-03-14 10:20:22,008 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: COMMENT ON COLUMN "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_pipeline__939658849"."opportunity_stage" IS 'stage name from salesforce' (base.py:2113)
2025-03-14 10:20:22,009 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: COMMENT ON COLUMN "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_pipeline__939658849"."close_date" IS 'this is the projected closed date' (base.py:2113)
2025-03-14 10:20:22,009 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: COMMENT ON COLUMN "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_pipeline__939658849"."opportunity_probability_new" IS 'custom probability forecasting' (base.py:2113)
2025-03-14 10:20:22,033 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Auditing snapshot SnapshotId<"db"."sqlmesh_example"."sfdc_pipeline": 1042212341> (evaluator.py:500)
2025-03-14 10:20:22,034 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: DESCRIBE "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_pipeline__939658849" (base.py:2113)
2025-03-14 10:20:22,036 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT COUNT(*) FROM (SELECT * FROM (SELECT * FROM "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_pipeline__939658849" AS "sqlmesh_example__sfdc_pipeline__939658849") AS "_q_0" WHERE "expected_amount" >= 100000) AS "audit" (base.py:2113)
2025-03-14 10:20:22,038 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: DESCRIBE "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_pipeline__939658849" (base.py:2113)
2025-03-14 10:20:22,041 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT COUNT(*) FROM (SELECT * FROM (SELECT * FROM "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_pipeline__939658849" AS "sqlmesh_example__sfdc_pipeline__939658849") AS "_q_0" WHERE ("opportunity_name") IS NULL AND TRUE) AS "audit" (base.py:2113)
2025-03-14 10:20:22,042 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Adding interval (2025-03-13 00:00:00, 2025-03-14 00:00:00) for snapshot SnapshotId<"db"."sqlmesh_example"."sfdc_pipeline": 1042212341> (interval.py:71)
2025-03-14 10:20:22,042 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"db"."sqlmesh_example"."sfdc_pipeline": 1042212341> (interval.py:255)
2025-03-14 10:20:22,048 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Promoting environment 'prod' (facade.py:164)
2025-03-14 10:20:22,059 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: DESCRIBE "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_opp_history__796608424" (base.py:2113)
2025-03-14 10:20:22,059 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Migrating table schema from 'db.sqlmesh__sqlmesh_example.sqlmesh_example__sfdc_opp_history__796608424__temp' to 'db.sqlmesh__sqlmesh_example.sqlmesh_example__sfdc_opp_history__796608424' (evaluator.py:863)
2025-03-14 10:20:22,059 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Altering table 'db.sqlmesh__sqlmesh_example.sqlmesh_example__sfdc_opp_history__796608424' (evaluator.py:1448)
2025-03-14 10:20:22,059 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: DESCRIBE "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_opp_history__796608424" (base.py:2113)
2025-03-14 10:20:22,060 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: DESCRIBE "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_opp_history__796608424__temp" (base.py:2113)
2025-03-14 10:20:22,061 - MainThread - sqlmesh.core.state_sync.db.snapshot - INFO - Pausing snapshot SnapshotId<"db"."sqlmesh_example"."sfdc_opp_history": 2691213078> (snapshot.py:172)
2025-03-14 10:20:22,061 - MainThread - sqlmesh.core.state_sync.db.snapshot - INFO - Unpausing snapshot SnapshotId<"db"."sqlmesh_example"."sfdc_opp_history": 1656795952> (snapshot.py:143)
2025-03-14 10:20:22,062 - MainThread - sqlmesh.core.state_sync.db.snapshot - INFO - Unpausing snapshot SnapshotId<"db"."sqlmesh_example"."sfdc_pipeline": 1042212341> (snapshot.py:143)
2025-03-14 10:20:22,064 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'db.sqlmesh_example' (evaluator.py:1060)
2025-03-14 10:20:22,064 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE SCHEMA IF NOT EXISTS "db"."sqlmesh_example" (base.py:2113)
2025-03-14 10:20:22,064 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view 'db.sqlmesh_example.sfdc_pipeline' to point at table 'db.sqlmesh__sqlmesh_example.sqlmesh_example__sfdc_pipeline__939658849' (evaluator.py:1367)
2025-03-14 10:20:22,065 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE OR REPLACE VIEW "db"."sqlmesh_example"."sfdc_pipeline" AS SELECT * FROM "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_pipeline__939658849" (base.py:2113)
2025-03-14 10:20:22,065 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: COMMENT ON COLUMN "db"."sqlmesh_example"."sfdc_pipeline"."id" IS 'primary key of opportunity table' (base.py:2113)
2025-03-14 10:20:22,065 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: COMMENT ON COLUMN "db"."sqlmesh_example"."sfdc_pipeline"."opportunity_name" IS 'name of the opportunity' (base.py:2113)
2025-03-14 10:20:22,065 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: COMMENT ON COLUMN "db"."sqlmesh_example"."sfdc_pipeline"."opportunity_stage" IS 'stage name from salesforce' (base.py:2113)
2025-03-14 10:20:22,066 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: COMMENT ON COLUMN "db"."sqlmesh_example"."sfdc_pipeline"."close_date" IS 'this is the projected closed date' (base.py:2113)
2025-03-14 10:20:22,066 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: COMMENT ON COLUMN "db"."sqlmesh_example"."sfdc_pipeline"."opportunity_probability_new" IS 'custom probability forecasting' (base.py:2113)
2025-03-14 10:20:22,066 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view 'db.sqlmesh_example.sfdc_opp_history' to point at table 'db.sqlmesh__sqlmesh_example.sqlmesh_example__sfdc_opp_history__796608424' (evaluator.py:1367)
2025-03-14 10:20:22,067 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE OR REPLACE VIEW "db"."sqlmesh_example"."sfdc_opp_history" AS SELECT * FROM "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__sfdc_opp_history__796608424" (base.py:2113)
2025-03-14 10:20:22,067 - MainThread - sqlmesh.core.state_sync.db.environment - INFO - Finalizing environment 'prod' (environment.py:98)
2025-03-14 10:20:22,084 - MainThread - root - INFO - Shutting down the event dispatcher (dispatcher.py:159)
